数据结构设计
===========

## 皮肤数据

皮肤数据格式

```json
{
	"snake":[
	{
		"name":"default",
		"headImage":"snakeSkin/default/head.png",
		"tailImage":"snakeSkin/default/head.png",
		"toning": [
			"FF0000FF",
			"00FF00FF",
			"0000FFFF"
		],
		"bodyImages":[
			"snakeSkin/default/head.png"
		],
		"unlockCoins":0
	},
	{
		"name":"bear",
		"headImage":"snakeSkin/bear/head.png",
		"tailImage":"snakeSkin/bear/tail.png",
		"bodyImages":[
			"snakeSkin/bear/body1.png",
			"snakeSkin/bear/body2.png",
			"snakeSkin/bear/body3.png",
			"snakeSkin/bear/body4.png",
			"snakeSkin/bear/body5.png"
		],
		"unlockCoins":3
	}],
	"block": [
	{

	}],
	"bar": [
	{
	}]
}
```

```cpp
class SkinDataBase
{
public:
	// 皮肤名称
	std::string m_strSkinName;
	// 皮肤解锁点数
	int m_nunlockCoins;
	// 皮肤的默认图片文件
	std::string m_strImageFile;
};

class SkinDataSnake : public SkinDataBase
{
public:
	std::string m_strImageFileTail;
	std::vector<std::string> m_vImageFileString;
	// 删除节点的模式
	int m_nDeleteMode;
};

class SkinDataBlock : public SkinDataBase
{
public:
};

class SkinDataBar : public SkinDataBase
{
public:
};
```

### 皮肤数据管理类

皮肤数据管理类有三种数据

1. 蛇和食物的皮肤
2. Block 的皮肤
3. Bar 的皮肤

```cpp
class SkinDataManager
{
public:
	// 单例
	static SkinDataManager* getInstance();
	// 析构函数，把几个 map 表的数据清空
	~SkinDataManager();

private:
	// 内部调用 initSkinData 函数
	SkinDataManager();

public:
	// 得到对应皮肤信息，找不到就返回空指针
	SkinDataSnake* getSnakeSkinData(const std::string& strSkinName);
	SkinDataBlock* getBlockSkinData(const std::string& strSkinName);
	SkinDataSnake* getBarSkinData(const std::string& strSkinName);

	// 得到皮肤的顺序列表
	const std::vector<std::string>& getSnakeSkinSequence();
	const std::vector<std::string>& getBlockSkinSequence();
	const std::vector<std::string>& getBarSkinSequence();

public:	// 蛇和食物相关操作
	// 返回套餐对应的图片路径
	std::string getSnakeHeadImageFileNameBySkinID(const std::string& strSkinName);
	// 返回蛇身能有的身体个数
	int getSnakeBodyImageCount(const std::string& strSkinName);
	// 返回蛇身的图片路径
	std::string getSnakeBodyImageFileNameBySkinID(const std::string& strSkinName, int nIndex);
	// 返回食物对应的图片路径
	std::string getFoodImageFileNameBySkinID(const std::string& strSkinName);

public: // 方块相关的操作
	// 返回食物对应的图片路径
	std::string getBlockImageFileNameBySkinID(const std::string& strSkinName);

private: // 私有函数
	// 初始化皮肤数据
	void initSkinData();

private:
	// 皮肤固定数据
	std::unordered_map<std::string, SkinDataSnake*> m_dataSnake;
	// 蛇皮肤的顺序
	std::vector<std::string> m_vSnakeSkinName;
	std::unordered_map<std::string, SkinDataBlock*> m_dataBlock;
	std::vector<std::string> m_vBlockSkinName;
	std::unordered_map<std::string, SkinDataBar*> m_dataBar;
	std::vector<std::string> m_vBarSkinName;
};
```

## 块

### 块数据

```cpp
class BlockData
{
public:
	// 方块的属性
	enum class Type
	{
		kType_None = 0,
		kType_Invincibility,  // 无敌
		kType_SlowDown 		  // 减速 
	};
	// Block的难度级别
	int m_nDifficult;
	// 块块的特殊属性
	Type m_eType;
};
```

### 块的UI数据

```cpp
class BlockNode : public cocos2d::Node
{
public:
	static BlockNode* create(int nNum);

	bool initWithData(int nNum);

	// 撞击
	// 1. 难度减一
	// 2. 重绘界面
	void hitted(int nNum = 1);
private:
	// 块的背景图片
	cocos2d::Sprite* m_pSpriteBackground = nullptr;

	// 块块的

	// 块块的数据
	BlockData m_data;
};
```

## 档条

```cpp
class BarData
{
public:
	// 档条的长度，垂直方向
	int m_nStep;
}
```

```cpp
class BarNode : public cocos2d::Node
{
public:
	static BarNode* create(const std::string& strImageFile, int nStep);

	// 控件初始化
	bool initWithData(const std::string& strImageFile);
private:
	// 背景图片
	cocos2d::ui::Scale9Sprite* m_pS9SBackground = nullptr;
};
```

## 蛇

### 蛇的UI数据结构

```cpp
class SnakeNode : public cocos2d::Node
{
public:
	// 增加蛇的身体，特殊处理的话是1就要增加尾巴
	void addBody(int nNum);

	// 减少蛇的身体长度，先减少body，最后再是尾巴
	void removeBody(int nNum);

	// 得到头部的节点
	cocos2d::Node* getHeadNode(); 

	// 设置蛇头的位置
	void setHeadXValue(float fX);

	// 更新函数，在外部帧回调中调用
	void update();
private:
	// 蛇的图片地址
	cocos2d::Sprite* m_pSpriteHead = nullptr;
	// 身体的容器，方便增加和删除内部节点
	std::vector<cocos2d::Sprite*> m_vBodySprites;
	// 尾巴节点
	cocos2d::Sprite* m_pSpriteTail = nullptr;
	// 蛇头部显示的长度数值
	cocos2d::Label* m_pLabelNum = nullptr;
};
```

### 蛇的全局管理类

单例，存储蛇的数据，因为游戏中就只有一条蛇

```cpp
class SnakeDataManager
{
public:
	enum class Status 
	{
		kType_Normal,
		kType_Invincibility,
		kType_SlowDown
	};
	// 单例对象
	static SnakeDataManager* getInstance();

	// 获取蛇的长度数据
	int getSize();

	// 设置蛇的长度数据
	void setSize();

	// 得到蛇的状态
	Status getStatus();

	// 设置蛇的状态
	void setStatus(Status eStatus);

	//获取蛇的皮肤
	std::string getSnakeSkin();

private:
	// 蛇的长度
	int m_nSize;
	// 当前蛇的皮肤
	std::string m_strSkinName;
	// 蛇的状态
	Status m_eStatus;
	// 蛇的速度 单位 步长/秒
	float m_fSpeed;
	// 可变化速度
	float m_fSpeedFactor = 1.0f;
	// 状态的时间，秒
	int m_nStatusLastTime = 0;
};
```

## 食物

食物的皮肤是跟着蛇的皮肤走的，就是头的图片

```cpp
class FoodData
{
public:
	// 食物的数字
	int m_nNum;
};
```

```cpp
class FoodNode : public cocos2d::Node
{
public:
	static FoodNode* create(int nNum);

	// 食物的数量
	bool initWithData(int nNum);
private:
	FoodData m_data;
	// 食物的背景图片
	cocos2d::Sprite* m_pSpriteBackground = nullptr;
	// 食物个数的 label
	cocos2d::Label* m_pLabelNum = nullptr;
};
```

## 对象工厂类

所有的对象都是通过对应的工厂类创建

```cpp
class UINodeFactory
{
public:
	// 创建蛇的身体
	static cocos2d::Sprite* createSnakeBody();
	// 针对皮肤的变化
	static cocos2d::Sprite* createSnakeHead(int nIndex);
	static cocos2d::Sprite* createSnakeTail();

	// 创建方块
	static BlockNode* createBlock();

	// 创建方块
	static BarNode* createBar();

	// 创建食物
	static FoodNode* createFood();
};
```

## 用户数据管理类


```cpp

// 用户皮肤开启状态结构
class UserSkinInfoData
{
public:
	// 皮肤的名称
	std::string m_strSkinName;
	// 皮肤当前剩余开启点数
	int m_nLeftCoins;
};

// 用户数据管理类
class UserDataManager
{
public:
	static UserDataManager* getInstance();
	~UserDataManager();

private:
	UserDataManager();

public:
	const std::string& getSnakeSkinName() const; 
	const std::string& getBlockSkinName() const; 
	const std::string& getBlockSkinName() const; 
	
	// 获取用户对应蛇的皮肤开启状态数据源
	const std::vector<UserSkinInfoData*>& getSnakeSkinStatus;

public:
	// 从数据库中读取所有数据
	bool loadDataFromDB();

	// 保存数据到数据库
	void saveDataToDB();

public:
	// 设置蛇的皮肤
	void setSnakeSkin(const std::string& strSkinName = "default");
	// 设置 Block 的皮肤
	void setBlockSkin(const std::string& strSkinName = "default");
	// 设皮肤置 Bar 的皮肤
	void setBarSkin(const std::string& strSkinName = "default");
private:
	// 历史最高分
	int m_nHistoryHighScore;
	// 用户金币数量
	int m_nCoins;

	// 几个对象的皮肤信息
	std::string m_strSnakeSkinName = "default";
	std::string m_strBlockSkinName = "default";
	std::string m_strBarSkinName = "default";

	// 蛇皮肤的开启状态
	std::vector<UserSkinInfoData*> m_mapSnakeSkinInfo;
};
```

## 'layer'的UI结构
```cpp
class layerData : public cocos2dx::Layer
{
public: 
	//创建一个背景
  static layerData* create();

public:
	//初始化屏幕中的内容
	void init();	
	// 创建食物、块块、Bar
	void generateLayerNodes();

private:
	//背景中的3个layer
	cocos2d::Layer* m_pfoodLayer = nullptr;	
	cocos2d::Layer* m_pblockayer = nullptr;	
	cocos2d::Layer* m_pbarLayer = nullptr;	
}

```
