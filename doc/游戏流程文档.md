游戏流程文档
============

## 游戏启动

任务优先级：A

1. 初始化皮肤数据
2. 初始化 UserDataManager 类

皮肤数据通过 `JSON` 数据文件提供，具体参见《数据结构设计》文档中的皮肤数据格式。

UserDataManager 类，需要先从数据库中读取对应的用户数据：

1. 当前玩家的蛇的皮肤名称
2. 历史最高分
3. 当前用户的金币
4. 皮肤开启数据表（JSON串，内部是个 hash 表，key 就是皮肤名称，value 就是剩余开启金币数）

## 开始场景

任务优先级：A

1. 显示当前皮肤的蛇
2. 显示历史最高分
3. 开始按钮、修改皮肤按钮

点击开始后跳转到**游戏场景**

点击修改皮肤按钮进入到**皮肤设置场景**

## 皮肤设置场景

任务优先级：B

1. 左上角显示返回按钮
2. 右上角显示当前金币
3. 下方显示一个 ScrollView，内部排列显示蛇的皮肤

这里皮肤的开启操作会影响用户保存的数据，一般都直接入库，操作通过 `UserDataManager` 类实现。（给一个操作数据库的类 `SqliteUtil`）。

功能：

1. 根据状态显示用户的皮肤是否开启
2. 点击未开启的皮肤可以消耗金币降低消耗
3. 点击返回后回到开始场景
4. 点击开启的皮肤后就把用户的皮肤替换掉

## 游戏场景

任务优先级：A

### 算法

1. 蛇的绘制
2. 蛇随着触摸的移动
3. Block 的生成
4. Food 的生成
5. Bar 的生成
6. 触碰事件的触发
7. 蛇的增长
8. 死亡判定
9. 暂停功能

### 游戏的主回调
游戏的主回调使用场景类中开启 `scheduleUpdate()` 即可，回调到场景类中的 `void update(float dt)` 函数，每帧进行判断。所有的逻辑判断都从这个 `update()` 中分发处理。

游戏暂停或者死亡后只需要调用 `unscheduleUpdate()` 即可结束主回调。

### 流程逻辑

游戏界面会同时存在 3 个背景 `layer` ，每个 `layer` 中会有三种对象：方块、食物、档条。并且三种物品各自有对应的层，数据不混杂。

每一帧都处理层的下降，判断是否碰撞到对象。如果碰撞到了按照以下逻辑处理：

1. 食物，直接食物消失（`removeFromParent()`），把对应食物上的点数增加到蛇身上
2. 方块，碰撞分别减去自己的数量，并且判断下是否方块消失或者死亡
3. 档条在 `onTouchMoved` 中要判断是否能移动

### 碰撞

1. 食物的碰撞只需要判断 `boundingBox()` 即可，相交即碰撞
2. 方块的碰撞需要特殊处理下，避免边缘偏移也被判断为相撞
3. 档条需要在 `onTouchMoved` 和 `update(float dt)` 中都判断下位置，重置到一个合理的位置
